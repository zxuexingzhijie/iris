# 鸢尾花数据集关联规则挖掘实验

## 实验目的

本实验旨在对鸢尾花（Iris）数据集应用关联规则挖掘算法，探索数据集中隐含的频繁项集和关联规则。通过本实验，我们将：

1. 学习如何对连续型数据进行离散化处理
2. 使用Apriori算法挖掘频繁项集
3. 提取有意义的关联规则
4. 分析不同鸢尾花品种的特征关联性
5. 可视化和解释挖掘结果

## 数据集简介

鸢尾花数据集包含150个样本，每个样本有4个特征：花萼长度、花萼宽度、花瓣长度、花瓣宽度，以及3种鸢尾花品种（山鸢尾、变色鸢尾、维吉尼亚鸢尾）。在本实验中，我们使用了预处理后的数据集。

## 关联规则算法介绍

关联规则挖掘是一种发现数据集中频繁项集和关联规则的方法。基本概念包括：

- **项（Item）**：数据集中的一个元素，如"花萼长度_低"
- **项集（Itemset）**：一个或多个项的集合，如{花萼长度_低, 花瓣长度_低}
- **支持度（Support）**：项集在整个数据集中出现的频率
- **置信度（Confidence）**：衡量规则的可靠性，表示包含前件的交易中同时包含后件的比例
- **提升度（Lift）**：衡量规则的相关性，值大于1表示正相关

### Apriori算法

Apriori算法是一种经典的关联规则挖掘算法，基于"频繁项集的所有子集也是频繁的"原理，采用逐层搜索、候选生成的策略。算法步骤：

1. 生成所有单项集并计算其支持度
2. 保留满足最小支持度的频繁项集
3. 根据频繁项集生成候选项集
4. 重复步骤2-3直到无法生成新的频繁项集
5. 从频繁项集中生成关联规则并计算置信度

## 实验方法与步骤

### 1. 数据预处理与离散化

由于关联规则算法通常应用于离散型数据，我们首先需要将连续型特征离散化。本实验中使用分位数（quantile）法将每个特征分为"低"、"中"、"高"三个等级。

```python
def discretize_data(df):
    """将连续型特征离散化，便于关联规则挖掘"""
    df_discretized = df.copy()
    features = ['sepal_length', 'sepal_width', 'petal_length', 'petal_width']
    
    for feature in features:
        # 使用分位数进行离散化，分为3个区间
        df_discretized[feature] = pd.qcut(df[feature], q=3, 
                           labels=[f'{feature}_低', f'{feature}_中', f'{feature}_高'])
    
    return df_discretized
```

### 2. 交易数据准备

关联规则算法需要将数据转换为"交易"格式。对鸢尾花数据，我们将每个样本的离散特征和品种类别组合成一个交易。

```python
def prepare_transactions(df_discretized):
    """将离散化的数据转换为交易数据格式"""
    transactions = []
    
    for _, row in df_discretized.iterrows():
        transaction = [
            row['sepal_length'], row['sepal_width'], 
            row['petal_length'], row['petal_width'], row['species']
        ]
        transactions.append(transaction)
    
    # 转换为one-hot编码
    te = TransactionEncoder()
    te_ary = te.fit_transform(transactions)
    df_transactions = pd.DataFrame(te_ary, columns=te.columns_)
    
    return df_transactions
```

### 3. 频繁项集挖掘

使用Apriori算法挖掘频繁项集，设置最小支持度为0.1：

```python
def mine_frequent_itemsets(df_transactions, min_support=0.1):
    """使用Apriori算法挖掘频繁项集"""
    frequent_itemsets = apriori(df_transactions, 
                               min_support=min_support, 
                               use_colnames=True)
    
    # 按支持度降序排序
    frequent_itemsets = frequent_itemsets.sort_values('support', ascending=False)
    
    return frequent_itemsets
```

### 4. 关联规则生成

从频繁项集中提取关联规则，设置最小置信度为0.7：

```python
def extract_association_rules(frequent_itemsets, min_confidence=0.7):
    """从频繁项集中提取关联规则"""
    rules = association_rules(frequent_itemsets, 
                             metric="confidence", 
                             min_threshold=min_confidence)
    
    # 按置信度降序排序
    rules = rules.sort_values('confidence', ascending=False)
    
    return rules
```

## 实验结果与分析

### 频繁项集

通过Apriori算法（最小支持度为0.1），我们挖掘出119个频繁项集。按支持度排序，最常见的频繁项集包括：

| 支持度 | 频繁项集 |
| ------ | -------- |
| 0.38 | 花萼宽度_低 |
| 0.373 | 花萼长度_中 |
| 0.36 | 花瓣长度_中 |
| 0.347 | 花瓣宽度_中 |
| 0.347 | 花萼长度_低 |
| 0.34 | 花萼宽度_中 |
| 0.333 | 山鸢尾(Iris-setosa) |
| 0.333 | 变色鸢尾(Iris-versicolor) |
| 0.333 | 花瓣长度_低, 花瓣宽度_低 |

挖掘结果显示了特征之间的强关联性，特别是：

1. **单特征频繁项**：所有单一特征的三个离散区间（低、中、高）中，"低"和"中"区间占比较高
2. **花瓣特征组合**：{花瓣长度_低, 花瓣宽度_低}是最常见的特征组合（支持度0.333）
3. **品种与特征组合**：{山鸢尾, 花瓣长度_低, 花瓣宽度_低}是高频组合（支持度0.333），表明山鸢尾与较小花瓣高度相关

#### 频繁项集大小分布

下图展示了频繁项集的大小分布情况，可以看出不同大小的频繁项集数量：

![频繁项集大小分布](https://typora-oss-picgo.oss-cn-beijing.aliyuncs.com/202505181506085.png)

### 关联规则

从频繁项集中提取出330条关联规则（最小置信度为0.7）。根据置信度和提升度排序，最强的规则包括：

#### 具有100%置信度的规则：

1. **花瓣特征规则**：
   - 花瓣长度_低 → 花瓣宽度_低 (置信度=1.0, 提升度=3.0)
   - 花瓣宽度_低 → 花瓣长度_低 (置信度=1.0, 提升度=3.0)

2. **品种预测规则**：
   - 花瓣长度_低 → 山鸢尾 (置信度=1.0, 提升度=3.0)
   - 花瓣宽度_低 → 山鸢尾 (置信度=1.0, 提升度=3.0)
   - 花瓣宽度_中, 花瓣长度_中, 花萼长度_中 → 变色鸢尾 (置信度=1.0, 提升度=3.0)

3. **复合特征规则**：
   - 花萼宽度_中, 山鸢尾 → 花瓣宽度_低 (置信度=1.0, 提升度=3.0)
   - 花萼长度_高, 山鸢尾花 → 花瓣长度_高 (置信度=1.0, 提升度=3.26)

#### 高提升度规则：

1. 花萼宽度_中, 花瓣长度_高, 维吉尼亚鸢尾 → 花萼长度_高, 花瓣宽度_高 (提升度=4.33)
2. 花萼宽度_中, 花瓣宽度_高 → 花萼长度_高, 维吉尼亚鸢尾 (提升度=4.33)
3. 花萼宽度_中 → 花萼长度_高, 花瓣长度_高, 花瓣宽度_高 (提升度=4.25)

这些规则表明，花瓣尺寸是区分鸢尾花品种的关键特征，具有较高的预测能力。

#### 关联规则可视化

下图展示了关联规则的指标分布情况，包括支持度、置信度和提升度：

![关联规则指标分布](https://typora-oss-picgo.oss-cn-beijing.aliyuncs.com/202505181506086.png)

下图通过气泡图展示了关联规则的三个关键指标之间的关系：

![关联规则气泡图](https://typora-oss-picgo.oss-cn-beijing.aliyuncs.com/202505181506087.png)

### 按品种的关联规则分析

#### 1. 山鸢尾(Iris-setosa)的特征模式

山鸢尾与花瓣特征存在强烈关联：
- 所有花瓣长度_低的样本都是山鸢尾 (置信度=1.0)
- 所有花瓣宽度_低的样本都是山鸢尾 (置信度=1.0)
- 花萼长度_低与山鸢尾高度相关 (置信度=0.865)

**特征组合**：山鸢尾的最佳识别特征是{花瓣长度_低, 花瓣宽度_低}，这也解释了为什么分类算法能有效区分山鸢尾。

#### 2. 变色鸢尾(Iris-versicolor)的特征模式

变色鸢尾与中等花瓣尺寸关联：
- 花瓣宽度_中 → 变色鸢尾 (置信度=0.923)
- 花瓣长度_中 → 变色鸢尾 (置信度=0.889)
- 花瓣宽度_中, 花瓣长度_中, 花萼长度_中 → 变色鸢尾 (置信度=1.0)

变色鸢尾还与花萼宽度_低显著相关（置信度=0.723），表明该品种有较窄的花萼。

#### 3. 维吉尼亚鸢尾(Iris-virginica)的特征模式

维吉尼亚鸢尾与较大的花瓣和花萼尺寸关联：
- 花瓣宽度_高 → 维吉尼亚鸢尾 (置信度=0.958)
- 花瓣长度_高 → 维吉尼亚鸢尾 (置信度=0.957)
- 花萼长度_高, 花瓣宽度_高 → 维吉尼亚鸢尾 (置信度=0.968)

维吉尼亚鸢尾与花萼长度_高也有较强关联（置信度=0.738），这与分类模型中的发现一致。

### 规则评估与可视化分析

基于关联规则评估指标：
- 大部分关键规则具有极高的置信度（>0.9）
- 所有显著规则的提升度都大于2.0，表明强正相关
- 品种预测规则的置信度普遍高于特征关联规则

这些关联规则不仅解释了鸢尾花数据集的特点，也为分类模型的有效性提供了理论支持。例如，SVM和随机森林在此数据集上表现良好，很可能是因为它们能够有效捕捉到这些特征组合模式。

## 结论

通过关联规则挖掘，我们发现：

1. 鸢尾花的品种与花瓣尺寸存在极强的关联性，这验证了分类任务中花瓣特征的重要性
2. 山鸢尾与小花瓣、变色鸢尾与中等花瓣、维吉尼亚鸢尾与大花瓣有显著关联
3. 复合特征规则往往比单一特征规则具有更强的预测能力

这些发现与我们之前的分类实验结果高度一致，证实了鸢尾花数据集中潜在的明确特征界限。关联规则挖掘为我们提供了可解释的知识，帮助理解分类器的决策依据，同时也能用于后续的特征选择和模型优化。

